<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" crossorigin="">
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" crossorigin=""></script>

    <style>
        #mapid {
            height: 350px;
        }

        .map-container {
            margin-top: 0px;
            border: 1px solid #D1D3D4;
            display: block;
        }
    </style>

</head>
<body>
    <div id="mapContainer" class="map-container">
    </div>
</body>
</html>

<script>
    const markers = MARKERS_LIST_REPLACEMENT

    ShowMap();

    function ShowMap() {
        document.getElementById('mapContainer').innerHTML = "<div id='mapid'></div>";
        var mymap = L.map('mapid');
        var bounds = new L.latLngBounds();
        var flight_path = [];

        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }
        ).addTo(mymap);

        let landingLightOn = false;

        markers.forEach(function (marker) {

            var marker_icon = L.icon({
                iconUrl: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAChSURBVChTY6A9KK+Zrl9e3sEP5cIBE5QGg5yCnf2Pn0VfuP8i60NOwZZ6qDAYMEJphurqZvmb9wIe/PrLzvD//z+Gf/++M+io7BTo7Kz4CJKHm/jvH5vCt28vGX5+B+IfLxh+fHvMwMLyWwAqjTARBFzceu///COu8P//HwZR4bcb1q8pDoRKobpxz65iRXmZew0qig8K1JRfJUCFaQIYGAAAlz3n2W9jSAAAAABJRU5ErkJggg==",
                iconAnchor: [8, 8],
                iconSize: [12, 12]
            });

            if (marker.LightLandingOn != landingLightOn) {

                let landingTooltip = marker.LightLandingOn ? 'Landing light ON' : 'Landing light OFF';

                var m = L.marker([marker.Latitude, marker.Longitude], { icon: marker_icon }).addTo(mymap);

                //.bindTooltip(landingTooltip, { direction: 'right' });

                m.bindPopup('<strong>' + landingTooltip + '</strong>' +
                    '<br/>Altitude: ' + marker.Altitude + 'ft' +
                    '<br/>True speed: ' + marker.Speed + 'Kts' +
                    '<br/>Altimeter: ' + marker.AltimeterInMillibars + 'mb' +
                    '<br/>Fuel weight:' + marker.FuelWeightKilograms + 'Kg');

                landingLightOn = marker.LightLandingOn;

            } else {
                L.marker([marker.Latitude, marker.Longitude], { icon: marker_icon, opacity: 0 }).addTo(mymap);
            }

            

            //markerButtonsDef = '<br/><input type="button" value="Add to departure" onclick="updateURL(\'departure\', \'' + marker.icao + '\');" class="btn btn-defaut btn-xs">'
            //    + '<br/><input type="button" value="Add to destination" onclick="updateURL(\'arrival\', \'' + marker.icao + '\');" class="btn btn-defaut btn-xs" style="margin-top:5px;">'
            //    + '<br/><input type="button" value="Add to alternative" onclick="updateURL(\'alternative\', \'' + marker.icao + '\');" class="btn btn-defaut btn-xs" style="margin-top:5px;">';

            //m.bindPopup('<strong>' + marker.name + '</strong><br/>' +
            //    marker.info + ' <br/> Runway size: ' +
            //    marker.runway_size + '<br/>Elevation: ' +
            //    marker.elevation + '<br/>Trasition: ' +
            //    marker.trasition + markerButtonsDef);

            //if (marker.isRoute) {
                flight_path.push([marker.Latitude, marker.Longitude]);

                bounds.extend([marker.Latitude, marker.Longitude]);
            //}
        });

        if (flight_path.length > 0) {

            L.polyline(flight_path, { color: '#5bc0de' }).addTo(mymap);

            mymap.fitBounds(bounds, { padding: [25, 25] });
        }
        else {
            mymap.setView([48.865195, 2.321033], 2);
        }
    }
</script>